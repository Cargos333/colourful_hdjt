{% extends 'base.html' %}

{% block title %}Mes Adresses - Colourful HDJT{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50">
    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-pink-500 via-purple-600 to-indigo-600 text-white">
        <div class="container mx-auto px-4 py-16">
            <div class="max-w-6xl mx-auto">
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <div class="mb-8 md:mb-0">
                        <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-white to-pink-100 bg-clip-text text-transparent">
                            Mes Adresses üìç
                        </h1>
                        <p class="text-xl text-pink-100 max-w-2xl">
                            G√©rez vos adresses de livraison et de facturation pour faciliter vos commandes.
                        </p>
                    </div>
                    <div class="relative">
                        <div class="w-32 h-32 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center border-4 border-white/30">
                            <span class="text-6xl">üìç</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-12">
        <div class="max-w-6xl mx-auto">
            <!-- Menu mobile -->
            <div class="lg:hidden mb-6">
                <button id="mobile-menu-btn" class="w-full bg-white rounded-2xl shadow-lg p-4 flex items-center justify-between hover:shadow-xl transition-all duration-200">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center mr-3">
                            <span class="text-xl">üìç</span>
                        </div>
                        <div>
                            <div class="font-semibold text-gray-800">Navigation rapide</div>
                            <div class="text-sm text-gray-500">Acc√©der aux sections</div>
                        </div>
                    </div>
                    <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg" id="menu-icon">‚ò∞</span>
                    </div>
                </button>

                <!-- Menu mobile d√©roulant -->
                <div id="mobile-menu" class="hidden bg-white rounded-2xl shadow-xl mt-2 overflow-hidden">
                    <nav class="divide-y divide-gray-100">
                        <a href="{{ url_for('profile') }}" class="flex items-center px-6 py-4 text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-all duration-200">
                            <div class="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center mr-4">
                                <span class="text-xl">üë§</span>
                            </div>
                            <div>
                                <div class="font-semibold">Mon profil</div>
                                <div class="text-sm text-gray-500">Vue d'ensemble</div>
                            </div>
                        </a>

                        <a href="{{ url_for('profile_orders') }}" class="flex items-center px-6 py-4 text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-all duration-200">
                            <div class="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center mr-4">
                                <span class="text-xl">üì¶</span>
                            </div>
                            <div>
                                <div class="font-semibold">Mes commandes</div>
                                <div class="text-sm text-gray-500">Historique et suivi</div>
                            </div>
                        </a>

                        <a href="{{ url_for('profile_favorites') }}" class="flex items-center px-6 py-4 text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition-all duration-200">
                            <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-4">
                                <span class="text-xl">‚ù§Ô∏è</span>
                            </div>
                            <div>
                                <div class="font-semibold">Mes favoris</div>
                                <div class="text-sm text-gray-500">Produits pr√©f√©r√©s</div>
                            </div>
                        </a>

                        <a href="{{ url_for('profile_addresses') }}" class="flex items-center px-6 py-4 bg-indigo-50 text-indigo-600 transition-all duration-200">
                            <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center mr-4">
                                <span class="text-xl">üìç</span>
                            </div>
                            <div>
                                <div class="font-semibold">Mes adresses</div>
                                <div class="text-sm text-indigo-500">Livraison et facturation</div>
                            </div>
                        </a>

                        <a href="{{ url_for('profile_settings') }}" class="flex items-center px-6 py-4 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-all duration-200">
                            <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center mr-4">
                                <span class="text-xl">‚öôÔ∏è</span>
                            </div>
                            <div>
                                <div class="font-semibold">Param√®tres</div>
                                <div class="text-sm text-gray-500">Pr√©f√©rences et s√©curit√©</div>
                            </div>
                        </a>

                        <a href="{{ url_for('logout') }}" class="flex items-center px-6 py-4 text-red-600 hover:bg-red-50 transition-all duration-200">
                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-4">
                                <span class="text-xl">üö™</span>
                            </div>
                            <div>
                                <div class="font-semibold">D√©connexion</div>
                                <div class="text-sm text-red-500">Se d√©connecter du compte</div>
                            </div>
                        </a>
                    </nav>
                </div>
            </div>

            <!-- Vue d'ensemble -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Navigation rapide - Desktop -->
                <div class="hidden lg:block lg:col-span-1">
                    <div class="bg-white rounded-3xl shadow-xl p-6 sticky top-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">Navigation rapide</h3>
                        <nav class="space-y-4">
                            <a href="{{ url_for('profile') }}" class="flex items-center px-4 py-4 rounded-xl text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-all duration-200 group">
                                <div class="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center mr-3 group-hover:bg-pink-200 transition-colors">
                                    <span class="text-xl">üë§</span>
                                </div>
                                <div>
                                    <div class="font-semibold">Mon profil</div>
                                    <div class="text-sm text-gray-500">Vue d'ensemble</div>
                                </div>
                            </a>

                            <a href="{{ url_for('profile_orders') }}" class="flex items-center px-4 py-4 rounded-xl text-gray-700 hover:bg-pink-50 hover:text-pink-600 transition-all duration-200 group">
                                <div class="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center mr-3 group-hover:bg-pink-200 transition-colors">
                                    <span class="text-xl">üì¶</span>
                                </div>
                                <div>
                                    <div class="font-semibold">Mes commandes</div>
                                    <div class="text-sm text-gray-500">Historique et suivi</div>
                                </div>
                            </a>

                            <a href="{{ url_for('profile_favorites') }}" class="flex items-center px-4 py-4 rounded-xl text-gray-700 hover:bg-purple-50 hover:text-purple-600 transition-all duration-200 group">
                                <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3 group-hover:bg-purple-200 transition-colors">
                                    <span class="text-xl">‚ù§Ô∏è</span>
                                </div>
                                <div>
                                    <div class="font-semibold">Mes favoris</div>
                                    <div class="text-sm text-gray-500">Produits pr√©f√©r√©s</div>
                                </div>
                            </a>

                            <a href="{{ url_for('profile_addresses') }}" class="flex items-center px-4 py-4 rounded-xl bg-indigo-50 text-indigo-600 transition-all duration-200">
                                <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center mr-3">
                                    <span class="text-xl">üìç</span>
                                </div>
                                <div>
                                    <div class="font-semibold">Mes adresses</div>
                                    <div class="text-sm text-indigo-500">Livraison et facturation</div>
                                </div>
                            </a>

                            <a href="{{ url_for('profile_settings') }}" class="flex items-center px-4 py-4 rounded-xl text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-all duration-200 group">
                                <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center mr-3 group-hover:bg-indigo-200 transition-colors">
                                    <span class="text-xl">‚öôÔ∏è</span>
                                </div>
                                <div>
                                    <div class="font-semibold">Param√®tres</div>
                                    <div class="text-sm text-gray-500">Pr√©f√©rences et s√©curit√©</div>
                                </div>
                            </a>

                            <div class="border-t border-gray-200 my-6"></div>

                            <a href="{{ url_for('logout') }}" class="flex items-center px-4 py-4 rounded-xl text-red-600 hover:bg-red-50 transition-all duration-200 font-medium">
                                <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                    <span class="text-xl">üö™</span>
                                </div>
                                <div>
                                    <div class="font-semibold">D√©connexion</div>
                                    <div class="text-sm text-red-500">Se d√©connecter du compte</div>
                                </div>
                            </a>
                        </nav>
                    </div>
                </div>

                <!-- Contenu principal -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- Statistiques rapides -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-3xl font-bold text-gray-800 mb-1">1</div>
                                    <div class="text-sm text-gray-500 font-medium">Adresse enregistr√©e</div>
                                </div>
                                <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center">
                                    <span class="text-2xl">üè†</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-pink-500 to-pink-600 h-2 rounded-full" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-3xl font-bold text-gray-800 mb-1">0</div>
                                    <div class="text-sm text-gray-500 font-medium">Adresse de travail</div>
                                </div>
                                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                                    <span class="text-2xl">üè¢</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 h-2 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Liste des adresses -->
                    <div class="bg-white rounded-2xl shadow-lg p-8">
                        <div class="flex items-center justify-between mb-8">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-800 mb-2">Vos adresses</h2>
                                <p class="text-gray-600">G√©rez vos adresses de livraison</p>
                            </div>
                            <button class="px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-semibold rounded-xl hover:shadow-lg transform hover:scale-105 transition-all duration-200">
                                ‚ûï Ajouter une adresse
                            </button>
                        </div>

                        <!-- Adresses charg√©es dynamiquement par JavaScript -->
                        <div class="space-y-6">
                            <!-- Les adresses seront charg√©es ici par loadAddresses() -->
                        </div>

                        <!-- √âtat vide (affich√© par d√©faut jusqu'au chargement) -->
                        <div id="loading-state" class="text-center py-12">
                            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <span class="text-4xl">‚è≥</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">Chargement...</h3>
                            <p class="text-gray-600">Veuillez patienter</p>
                        </div>
                    </div>

                    <!-- Conseils -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-8 border border-blue-200">
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                                <span class="text-2xl">üí°</span>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-blue-800 mb-3">Conseils pour vos adresses</h3>
                                <ul class="space-y-2 text-blue-700">
                                    <li class="flex items-start">
                                        <span class="text-blue-500 mr-2">‚Ä¢</span>
                                        <span>Utilisez des adresses pr√©cises pour √©viter les retards de livraison</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-blue-500 mr-2">‚Ä¢</span>
                                        <span>D√©finissez une adresse par d√©faut pour acc√©l√©rer vos commandes</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-blue-500 mr-2">‚Ä¢</span>
                                        <span>S√©parez vos adresses personnelles et professionnelles si n√©cessaire</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Animation pour les cartes statistiques */
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
}

.hover\:animate-float:hover {
    animation: float 2s ease-in-out infinite;
}

/* Animation pour le menu mobile */
@keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

#mobile-menu {
    animation: slideDown 0.3s ease-out;
}
</style>

<script>
// Charger les adresses au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    loadAddresses();
    setupAddressForm();
});

// Configuration du modal d'adresse
let currentEditingAddress = null;

function setupAddressForm() {
    const addAddressBtn = document.querySelector('button.bg-gradient-to-r.from-pink-500.to-purple-600');
    if (addAddressBtn) {
        addAddressBtn.addEventListener('click', () => openAddressModal());
    }
}

function openAddressModal(address = null) {
    currentEditingAddress = address;
    
    // Cr√©er le modal
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
        <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
            <div class="p-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">
                        ${address ? 'Modifier l\'adresse' : 'Ajouter une adresse'}
                    </h2>
                    <button onclick="closeAddressModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>

                <form id="address-form" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nom de l'adresse *</label>
                        <input type="text" name="name" placeholder="Ex: Maison, Travail..."
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
                               value="${address?.name || ''}" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nom du destinataire *</label>
                        <input type="text" name="recipient_name" placeholder="Pr√©nom et nom"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
                               value="${address?.recipient_name || ''}" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">T√©l√©phone</label>
                        <input type="tel" name="phone" placeholder="+269 XX XX XX XX"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
                               value="${address?.phone || ''}">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Adresse ligne 1 *</label>
                        <input type="text" name="address_line_1" placeholder="Num√©ro et rue"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
                               value="${address?.address_line_1 || ''}" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Adresse ligne 2</label>
                        <input type="text" name="address_line_2" placeholder="Compl√©ment d'adresse (optionnel)"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
                               value="${address?.address_line_2 || ''}">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">√éle *</label>
                        <select name="country" id="country-select" onchange="updateRegionOptions()" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all" required>
                            <option value="">S√©lectionner une √Æle</option>
                            <option value="Grande Comore" ${(address?.country || 'Grande Comore') === 'Grande Comore' ? 'selected' : ''}>üèùÔ∏è Grande Comore</option>
                            <option value="Anjouan" ${address?.country === 'Anjouan' ? 'selected' : ''}>üèùÔ∏è Anjouan</option>
                            <option value="Moh√©li" ${address?.country === 'Moh√©li' ? 'selected' : ''}>üèùÔ∏è Moh√©li</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">R√©gion *</label>
                        <select name="region" id="region-select" onchange="updateShippingPrice()" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all" required>
                            <option value="">S√©lectionner une r√©gion</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ville *</label>
                            <input type="text" name="city" placeholder="Ville"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
                                   value="${address?.city || ''}" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Code postal</label>
                            <input type="text" name="postal_code" placeholder="Optionnel"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all"
                                   value="${address?.postal_code || ''}">
                            <p class="mt-1 text-xs text-gray-500">Le code postal est optionnel</p>
                        </div>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" name="is_default" id="is_default" 
                               class="w-4 h-4 text-pink-600 bg-gray-100 border-gray-300 rounded focus:ring-pink-500"
                               ${address?.is_default ? 'checked' : ''}>
                        <label for="is_default" class="ml-2 text-sm font-medium text-gray-700">
                            D√©finir comme adresse par d√©faut
                        </label>
                    </div>

                    <div class="flex gap-4 pt-4">
                        <button type="submit" class="flex-1 px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-semibold rounded-xl hover:shadow-lg transform hover:scale-105 transition-all duration-200">
                            ${address ? 'Modifier' : 'Ajouter'} l'adresse
                        </button>
                        <button type="button" onclick="closeAddressModal()" 
                                class="px-6 py-3 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-all duration-200">
                            Annuler
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;

    document.body.appendChild(modal);
    
    // Charger le script address-form.js s'il n'est pas d√©j√† charg√©
    if (!window.updateRegionOptions) {
        const script = document.createElement('script');
        script.src = '/static/js/address-form.js?v=' + Date.now();
        document.head.appendChild(script);
    }
    
    // Initialiser les options de r√©gion pour le pays s√©lectionn√©
    setTimeout(() => {
        if (window.updateRegionOptions) {
            updateRegionOptions();
            if (address?.region) {
                document.getElementById('region-select').value = address.region;
                if (window.updateShippingPrice) {
                    updateShippingPrice();
                }
            }
        }
    }, 200);
    
    // Gestionnaire pour le formulaire
    const form = modal.querySelector('#address-form');
    form.addEventListener('submit', handleAddressSubmit);
}

function closeAddressModal() {
    const modal = document.querySelector('.fixed.inset-0.bg-black.bg-opacity-50');
    if (modal) {
        modal.remove();
    }
    currentEditingAddress = null;
}

async function handleAddressSubmit(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const data = {
        name: formData.get('name'),
        recipient_name: formData.get('recipient_name'),
        phone: formData.get('phone'),
        address_line_1: formData.get('address_line_1'),
        address_line_2: formData.get('address_line_2'),
        city: formData.get('city'),
        region: formData.get('region'),
        postal_code: formData.get('postal_code') || null,
        country: formData.get('country'),
        is_default: formData.has('is_default'),
        address_type: 'shipping'
    };

    try {
        let response;
        if (currentEditingAddress) {
            // Modifier l'adresse existante
            response = await fetch(`/api/addresses/${currentEditingAddress.id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify(data)
            });
        } else {
            // Cr√©er une nouvelle adresse
            response = await fetch('/api/addresses', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify(data)
            });
        }

        const result = await response.json();

        if (response.ok) {
            showNotification(
                currentEditingAddress ? 'Adresse modifi√©e avec succ√®s !' : 'Adresse ajout√©e avec succ√®s !',
                'success'
            );
            closeAddressModal();
            loadAddresses();
        } else {
            showNotification(result.error || 'Erreur lors de la sauvegarde', 'error');
        }
    } catch (error) {
        console.error('Erreur:', error);
        showNotification('Erreur r√©seau lors de la sauvegarde', 'error');
    }
}

async function loadAddresses() {
    try {
        console.log('Loading addresses...');
        const response = await fetch('/api/addresses', {
            credentials: 'include'
        });
        console.log('Response status:', response.status);
        const addresses = await response.json();
        console.log('Addresses data:', addresses);

        // Cacher l'√©tat de chargement
        const loadingState = document.getElementById('loading-state');
        if (loadingState) loadingState.style.display = 'none';

        if (response.ok) {
            displayAddresses(addresses);
            updateStats(addresses);
        } else {
            console.error('Erreur lors du chargement des adresses:', addresses.error);
        }
    } catch (error) {
        console.error('Erreur r√©seau:', error);
        // Cacher l'√©tat de chargement m√™me en cas d'erreur
        const loadingState = document.getElementById('loading-state');
        if (loadingState) loadingState.style.display = 'none';
    }
}

function displayAddresses(addresses) {
    const container = document.querySelector('.space-y-6');
    if (!container) return;

    if (addresses.length === 0) {
        container.innerHTML = `
            <div class="col-span-full">
                <div class="bg-white rounded-2xl shadow-lg p-12 text-center">
                    <div class="w-24 h-24 mx-auto bg-gradient-to-br from-blue-100 to-pink-100 rounded-full flex items-center justify-center mb-6">
                        <span class="text-6xl">üìç</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Aucune adresse trouv√©e</h3>
                    <p class="text-gray-600 mb-8 max-w-md mx-auto">
                        Ajoutez votre premi√®re adresse de livraison pour faciliter vos commandes.
                    </p>
                    <button onclick="openAddressModal()" class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-semibold rounded-xl hover:shadow-lg transform hover:scale-105 transition-all duration-200">
                        <span class="mr-2">‚ûï</span>
                        Ajouter une adresse
                    </button>
                </div>
            </div>
        `;
        return;
    }

    let html = '';
    addresses.forEach(address => {
        html += `
            <div class="border border-gray-200 rounded-xl p-6 hover:border-pink-300 transition-all duration-200">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center mr-4">
                            <span class="text-2xl">üè†</span>
                        </div>
                        <div>
                            <div class="flex items-center gap-3 mb-1">
                                <h3 class="text-xl font-bold text-gray-800">${address.name}</h3>
                                ${address.is_default ? '<span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">Par d√©faut</span>' : ''}
                            </div>
                            <p class="text-gray-600">${address.recipient_name}</p>
                            ${address.phone ? `<p class="text-gray-600">${address.phone}</p>` : ''}
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="openAddressModal(${JSON.stringify(address).replace(/"/g, '&quot;')})"
                                class="px-3 py-1 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors">
                            ‚úèÔ∏è Modifier
                        </button>
                        <button onclick="deleteAddress(${address.id})"
                                class="px-3 py-1 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600 transition-colors">
                            üóëÔ∏è Supprimer
                        </button>
                    </div>
                </div>

                <div class="text-gray-700">
                    <p>${address.address_line_1}</p>
                    ${address.address_line_2 ? `<p>${address.address_line_2}</p>` : ''}
                    <p>${address.postal_code ? address.postal_code + ' ' : ''}${address.city}</p>
                    <p><strong>${address.region || ''}</strong> - ${address.country}</p>
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

function updateStats(addresses) {
    // Mettre √† jour les statistiques
    const totalAddresses = addresses.length;
    const defaultAddresses = addresses.filter(addr => addr.is_default).length;

    // Mettre √† jour les √©l√©ments HTML
    const statElements = document.querySelectorAll('.text-3xl.font-bold.text-gray-800');
    if (statElements.length >= 2) {
        statElements[0].textContent = totalAddresses;
        statElements[1].textContent = defaultAddresses;
    }
}

async function deleteAddress(addressId) {
    if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette adresse ?')) {
        return;
    }

    try {
        const response = await fetch(`/api/addresses/${addressId}`, {
            method: 'DELETE',
            credentials: 'include'
        });

        const result = await response.json();

        if (response.ok) {
            showNotification('Adresse supprim√©e avec succ√®s', 'success');
            loadAddresses();
        } else {
            showNotification(result.error || 'Erreur lors de la suppression', 'error');
        }
    } catch (error) {
        console.error('Erreur:', error);
        showNotification('Erreur r√©seau lors de la suppression', 'error');
    }
}

function showNotification(message, type = 'info') {
    // Supprimer les notifications existantes
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => notification.remove());

    // Cr√©er une nouvelle notification
    const notification = document.createElement('div');
    notification.className = `notification fixed top-4 right-4 px-6 py-3 rounded-xl text-white font-semibold z-50 transform translate-x-full transition-transform duration-300 ${
        type === 'success' ? 'bg-green-500' :
        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
    }`;
    notification.textContent = message;

    document.body.appendChild(notification);

    // Animation d'entr√©e
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 100);

    // Supprimer apr√®s 5 secondes
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 5000);
}

// Menu mobile toggle
document.getElementById('mobile-menu-btn').addEventListener('click', function() {
    const menu = document.getElementById('mobile-menu');
    const icon = document.getElementById('menu-icon');

    if (menu.classList.contains('hidden')) {
        menu.classList.remove('hidden');
        icon.textContent = '‚úï';
        this.classList.add('ring-2', 'ring-indigo-300');
    } else {
        menu.classList.add('hidden');
        icon.textContent = '‚ò∞';
        this.classList.remove('ring-2', 'ring-indigo-300');
    }
});

// Fermer le menu mobile quand on clique ailleurs
document.addEventListener('click', function(event) {
    const menu = document.getElementById('mobile-menu');
    const btn = document.getElementById('mobile-menu-btn');
    const icon = document.getElementById('menu-icon');

    if (!btn.contains(event.target) && !menu.contains(event.target)) {
        menu.classList.add('hidden');
        icon.textContent = '‚ò∞';
        btn.classList.remove('ring-2', 'ring-indigo-300');
    }
});
</script>
{% endblock %}